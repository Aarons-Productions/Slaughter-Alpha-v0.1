<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SLAUGHTER v0.2.5 - REVAMP</title>
    <style>
        body { margin: 0; background: #111; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: 'Courier New', monospace; color: #f00; }
        #game-container { width: 800px; height: 600px; position: relative; border: 4px solid #333; overflow: hidden; background: #000; box-shadow: 0 0 50px #000; }
        #menu, #game-over { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #game-over { display: none; color: #ff4444; }
        .btn { padding: 15px 30px; background: #200; border: 2px solid #f00; color: #f00; font-size: 1.5rem; cursor: pointer; margin-top: 20px; }
        .btn:hover { background: #f00; color: #fff; }
        #ui { position: absolute; top: 10px; left: 10px; z-index: 10; pointer-events: none; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; border: 1px solid #f00; border-radius: 50%; transform: translate(-50%, -50%); z-index: 10; }
        #flash { position: absolute; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 5; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="flash"></div>
        
        <div id="menu">
            <h1 style="font-size: 3.5rem;">SLAUGHTER</h1>
            <p>AARONS PRODUCTIONS | ALPHA V0.2.5</p>
            <button class="btn" onclick="startGame()">INITIATE</button>
        </div>

        <div id="game-over">
            <h1 style="font-size: 3.5rem;">SLAUGHTERED</h1>
            <p id="final-stats"></p>
            <button class="btn" onclick="location.reload()">REDEPLOY</button>
        </div>

        <div id="ui">
            <div>OBJECTIVE: SURVIVE</div>
            <div>THREATS NEUTRALIZED: <span id="k">0</span></div>
            <div id="stamina-ui">STAMINA: 100%</div>
        </div>
        <div id="crosshair"></div>
    </div>

    <audio id="menuMusic" src="MainMenu.mp3" loop></audio>
    <audio id="gameMusic" src="InGame.mp3" loop></audio>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { PointerLockControls } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/PointerLockControls.js';

        const container = document.getElementById('game-container');
        const menuMusic = document.getElementById('menuMusic');
        const gameMusic = document.getElementById('gameMusic');
        
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // Daylight Sky
        const camera = new THREE.PerspectiveCamera(75, 800 / 600, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: false });
        renderer.setSize(800, 600);
        container.appendChild(renderer.domElement);

        const controls = new PointerLockControls(camera, container);
        window.startGame = () => {
            document.getElementById('menu').style.display = 'none';
            menuMusic.pause();
            gameMusic.play();
            controls.lock();
        };

        // --- LIGHTING ---
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(5, 10, 5);
        scene.add(sun, new THREE.AmbientLight(0x404040));

        // --- WORLD & GUN ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshBasicMaterial({ color: 0x228b22 }));
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        const gun = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.3, 1.2), new THREE.MeshBasicMaterial({ color: 0x111111 }));
        scene.add(gun);

        const enemies = [];
        let kills = 0, isDead = false;
        for(let i=0; i<6; i++) {
            const e = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), new THREE.MeshBasicMaterial({ color: 0xff0000 }));
            e.position.set(Math.random()*40-20, 1, -20 - Math.random()*20);
            scene.add(e);
            enemies.push(e);
        }

        // --- MOVEMENT VARIABLES ---
        const keys = {};
        let velocity = new THREE.Vector3();
        let canJump = true;
        document.addEventListener('keydown', (e) => keys[e.code] = true);
        document.addEventListener('keyup', (e) => keys[e.code] = false);

        container.addEventListener('mousedown', () => {
            if(!controls.isLocked || isDead) return;
            document.getElementById('flash').style.opacity = "0.5";
            setTimeout(() => document.getElementById('flash').style.opacity = "0", 50);
            
            const ray = new THREE.Raycaster();
            ray.setFromCamera(new THREE.Vector2(0,0), camera);
            const hits = ray.intersectObjects(enemies);
            if(hits.length > 0) {
                hits[0].object.position.set(Math.random()*40-20, 1, -30);
                kills++;
                document.getElementById('k').innerText = kills;
            }
        });

        function animate() {
            requestAnimationFrame(animate);
            if(controls.isLocked && !isDead) {
                const moveSpeed = keys['ShiftLeft'] ? 0.3 : 0.15;
                if(keys['KeyW']) controls.moveForward(moveSpeed);
                if(keys['KeyS']) controls.moveForward(-moveSpeed);
                if(keys['KeyA']) controls.moveRight(-moveSpeed);
                if(keys['KeyD']) controls.moveRight(moveSpeed);

                // Gravity & Jumping
                if(keys['Space'] && canJump) { velocity.y = 0.15; canJump = false; }
                camera.position.y += velocity.y;
                if(camera.position.y > 1.6) { velocity.y -= 0.01; } 
                else { camera.position.y = 1.6; velocity.y = 0; canJump = true; }

                // Gun Viewmodel Follow
                gun.position.copy(camera.position);
                gun.rotation.copy(camera.rotation);
                gun.translateZ(-1); gun.translateX(0.5); gun.translateY(-0.4);
            }

            enemies.forEach(e => {
                const dir = new THREE.Vector3().subVectors(camera.position, e.position).normalize();
                e.position.x += dir.x * 0.06;
                e.position.z += dir.z * 0.06;
                e.lookAt(camera.position);
                
                if(e.position.distanceTo(camera.position) < 1.2 && !isDead) {
                    isDead = true;
                    controls.unlock();
                    document.getElementById('game-over').style.display = 'flex';
                    document.getElementById('final-stats').innerText = "THREATS NEUTRALIZED: " + kills;
                    gameMusic.pause();
                }
            });
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
