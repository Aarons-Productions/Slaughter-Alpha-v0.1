<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SLAUGHTER</title>
    <style>
        body { margin: 0; background: #000; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: 'Courier New', monospace; touch-action: none; }
        #game-container { width: 800px; height: 600px; position: relative; border: 2px solid #333; background: #000; }
        .overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: rgba(0,0,0,0.95); color: #f00; }
        
        /* MOBILE OVERLAY */
        #mobile-hud { position: absolute; inset: 0; display: none; pointer-events: none; z-index: 50; }
        .joystick-zone { position: absolute; bottom: 20px; width: 150px; height: 150px; background: rgba(255,0,0,0.05); border: 1px dashed rgba(255,0,0,0.2); border-radius: 50%; pointer-events: auto; }
        #move-joy { left: 30px; }
        #look-joy { right: 30px; }
        #shoot-btn { position: absolute; bottom: 180px; right: 60px; width: 70px; height: 70px; background: rgba(255,0,0,0.3); border: 2px solid #f00; border-radius: 50%; pointer-events: auto; }
        
        #controls-hint { position: absolute; bottom: 10px; left: 10px; font-size: 10px; color: #444; pointer-events: none; }
        #mobile-btn { position: absolute; top: 10px; right: 10px; z-index: 110; padding: 5px; background: #100; color: #f00; border: 1px solid #f00; cursor: pointer; }
    </style>
</head>
<body>

    <div id="game-container">
        <button id="mobile-btn" onclick="toggleMobile()">MOBILE: OFF</button>
        
        <div id="menu" class="overlay">
            <h1>SLAUGHTER</h1>
            <p>AARONS PRODUCTIONS | v0.2.8</p>
            <button style="padding:15px; background:#200; color:#f00; border:2px solid #f00; cursor:pointer;" onclick="startGame()">START</button>
        </div>

        <div id="mobile-hud">
            <div id="move-joy" class="joystick-zone"></div>
            <div id="look-joy" class="joystick-zone"></div>
            <div id="shoot-btn"></div>
        </div>

        <div id="controls-hint">WASD: MOVE | MOUSE: LOOK | SHIFT: SPRINT</div>
    </div>

    <audio id="menuMusic" src="MainMenu.mp3" loop></audio>
    <audio id="gameMusic" src="InGame.mp3" loop></audio>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { PointerLockControls } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/PointerLockControls.js';

        let mobileActive = false;
        const container = document.getElementById('game-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, 800/600, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: false });
        renderer.setSize(800, 600);
        container.appendChild(renderer.domElement);

        const controls = new PointerLockControls(camera, container);

        // --- MAP ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100,100), new THREE.MeshBasicMaterial({color:0x0a0a0a}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        const walls = [];
        const wallMat = new THREE.MeshBasicMaterial({color:0x330000});
        function addBox(w,h,d,x,z) {
            const m = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), wallMat);
            m.position.set(x, h/2, z);
            scene.add(m);
            walls.push(m);
        }
        addBox(60, 10, 1, 0, -30); // Back wall
        addBox(4, 4, 4, 5, -10);   // Pillar
        addBox(4, 4, 4, -15, -5);  // Pillar

        // --- GUN ---
        const gun = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.2, 0.7), new THREE.MeshBasicMaterial({color:0x111}));
        scene.add(gun);

        window.toggleMobile = () => {
            mobileActive = !mobileActive;
            document.getElementById('mobile-hud').style.display = mobileActive ? 'block' : 'none';
            document.getElementById('mobile-btn').innerText = `MOBILE: ${mobileActive ? 'ON' : 'OFF'}`;
        };

        window.startGame = () => {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('gameMusic').play();
            if(!mobileActive) controls.lock();
        };

        const keys = {};
        document.addEventListener('keydown', e => keys[e.code] = true);
        document.addEventListener('keyup', e => keys[e.code] = false);

        camera.position.set(0, 1.6, 5);
        let recoil = 0;

        function animate() {
            requestAnimationFrame(animate);
            
            const oldPos = camera.position.clone();
            const moveSpeed = keys['ShiftLeft'] ? 0.25 : 0.12;

            if(controls.isLocked || mobileActive) {
                if(keys['KeyW']) controls.moveForward(moveSpeed);
                if(keys['KeyS']) controls.moveForward(-moveSpeed);
                if(keys['KeyA']) controls.moveRight(-moveSpeed);
                if(keys['KeyD']) controls.moveRight(moveSpeed);
            }

            // Slide Collision
            walls.forEach(w => {
                const b = new THREE.Box3().setFromObject(w);
                if(b.containsPoint(camera.position)) camera.position.copy(oldPos);
            });

            // Gun logic
            gun.position.copy(camera.position);
            gun.rotation.copy(camera.rotation);
            gun.translateZ(-0.6 + recoil); gun.translateX(0.3); gun.translateY(-0.3 + recoil);
            recoil *= 0.8;

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
